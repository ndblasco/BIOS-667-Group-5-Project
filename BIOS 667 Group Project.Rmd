---
title: "BIOS 667 Group Project"
author: 
- Lily Bai
- Nathalie Blasco
- Yihao Peng
- Lauren Rackley
- Sirui Wu
date: "`r Sys.Date()`"
output:
  pdf_document:
    latex_engine: xelatex
    keep_tex: true
---

```{r,echo=FALSE}
# Load packages
suppressPackageStartupMessages({
library(haven) # for reading in data 
library(dplyr) # for manipulating data
library(gtsummary) # for making table 1
library(cards)
library(kableExtra)
library(huxtable) # for styling tables
library(tidyr) # for reshaping data
library(gtreg) # for making tables
})

# Read in data
cdystonia <- read_dta("Data/cdystonia.dta") # mapping to Data folder in GitHub repo

# Inspect data
head(cdystonia)

cdystonia <- cdystonia %>% dplyr::mutate(
    trt = dplyr::case_when(
      treat == 1 ~ "10000 U",
      treat == 2 ~ "5000 U",
      treat == 3 ~ "Placebo"
    ),
    trt = factor(trt, levels = c("Placebo", "5000 U", "10000 U")),
    sexc = dplyr::case_when(
      sex == 1 ~ "Female",
      sex == 2 ~ "Male"))

# Filter to only week 0
cdystonia_wk0 <- cdystonia %>%
  filter(week == 0)

tbl <- cdystonia_wk0 |>
  tbl_summary(by = trt, 
              include = c(sexc, age,twstrs),
              type=all_continuous()~"continuous2",
              label = list(sexc = "Sex",age~"Age (years)",twstrs="TWSTRS total score at baseline"),
              statistic = list(
      age ~ c(
      "{N_obs}",
      "{mean} ({sd})",
      "{median}",
      "{min}, {max}"),
      all_categorical() ~ "{n} ({p}%)",
      twstrs~"{mean} ({sd})")) |>
  add_overall() |>
  add_p(pvalue_fun = ~style_sigfig(., digits = 4)) |>
  modify_footnote(
    all_stat_cols() ~ 
      "BotB = botulinum toxin type B; TWSTRS = Toronto Western Spasmodic Torticollis Rating Scale.",
    abbreviation = FALSE
  ) |>
  modify_spanning_header(c(stat_2,stat_3)~"**BotB**")

#show_header_names(tbl)

# making a wide dataset
cdystonia_wide <- cdystonia %>%
  pivot_wider(
    id_cols = c(id, trt, site, age, sexc), 
    names_from = week,                     
    values_from = twstrs,              
    names_prefix = "twstrs_"                 
  ) 

ten_subjects_wide <- cdystonia_wide %>% 
  head(10)

tbl2 <-
  ten_subjects_wide %>%
  dplyr::select(id, trt, age, sexc, twstrs_2, twstrs_4, twstrs_8, twstrs_12, twstrs_16) %>%
  
  # 1. Create the gtsummary listing object
  tbl_listing() %>%
  
  # 2. Modify the column headers using modify_header()
  modify_header(
    id = "**ID**",
    trt = "**Group**",
    age = "**Age**",
    sexc = "**Sex**",
    twstrs_2 = "**Week 2**",
    twstrs_4 = "**Week 4**",
    twstrs_8 = "**Week 8**",
    twstrs_12 = "**Week 12**",
    twstrs_16 = "**Week 16**"
  ) %>%
  
  # 3. Convert to gt and apply final formatting
  as_gt() %>%
  gt::tab_header(title="Listing 1. TWSTRS scores for 109 patients with CD at weeks 2,4,8,12,16") %>%
  gt::opt_row_striping()
```

## Introduction
The purpose of this project is to examine the effects of botulism toxin type B (BotB) to treat cervical dystonia over time. Cervical dystonia (CD) is a chronic neurological disorder, in which patients have painful involuntary contractions in neck muscles. CD is more prevalent in women (Jankovic et al., 2023). The prevalence of CD is estimated to be 28-183 cases per million. The data comes from a multicenter randomized clinical trial for cervical dystonia patients with 9 U.S. sites. Botulism toxin types A and B are first-line treatments for CD (Wetmore et al., 2025). The treatment groups included in the study were placebo, 5000 U BotB, and 10000 U BotB. The response variable is Toronto Western Spasmodic Torticollis Rating Scale (TWSTRS) total score, which ranges from 0 to 85 and is comprised of disability (0-30), pain (0-20), and severity (0-35) subscores. Only total score is included in this data.The TWSTRS score was measured at week 0 (baseline), and 2,4,6,8,12, and 16 weeks after treatment start. Site is included in the dataset but no further details about site were included in the available dataset documentation.

## Methods

### *Study Population*
Inclusion and exclusion criteria for the trial were not available. Duration of CD and age at onset were not known. The study included 109 patients (67 (61%)) females.The mean age was 56 (12). Median age was 56 years. The mean TWSTRS score at baseline was 46 (10). It was not known if the patients received prior BotB treatments. Information about the randomization schedule was not provided. 

### *Statistical Analyses*
Number of observations, mean, median, standard deviation (SD), minimum (min) and maximum (max) were provided for age. Mean and SD were calculated for TWSTRS score at baseline. Frequencies and percentages were reported for categorical variables. GLM, GLMM, and GEE models were fit using TWSTRS total score as the response variable and blank, blank, blank as covariates.

## Results
Clear Figures/tables describing and summarizing key outcomes/variables
Clear Figures/table illustrating results that directly addresses question(s)
Proper and clear descriptions of results based on figures and tables, along with diagnostics
Code chunks should be hidden in the document, with only text, figures, and tables showing

```{r,echo=FALSE}
# adding Table 1
as_kable_extra(tbl,
               booktabs=TRUE,
               longtable=TRUE,
               linesep="",
               caption = "Patient Characteristics at Baseline",
                table.envir = "table",
               table.attr = "position='h!'")

# adding Table 2
tbl2

# someone help position these. table 1 should come before table 2
```

## Discussion
Summarization of main points, conclusions based in results
Summarization of the various models applied, which ones you prefer and base your interpretations off of and why
Discussion of limitations if any


## References
Add references here later
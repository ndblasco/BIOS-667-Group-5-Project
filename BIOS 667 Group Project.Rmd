---
title: "BIOS 667 Group Project"
author: 
- Lily Bai
- Nathalie Blasco
- Yihao Peng
- Lauren Rackley
- Sirui Wu
date: "`r Sys.Date()`"
output:
  pdf_document:
    latex_engine: xelatex
    keep_tex: true
---

```{r,echo=FALSE}
# Load packages
suppressPackageStartupMessages({
library(haven) # for reading in data 
library(dplyr) # for manipulating data
library(gtsummary) # for making table 1
library(cards)
library(kableExtra)
library(huxtable) # for styling tables
library(tidyr) # for reshaping data
library(gtreg) # for making tables
})

# Read in data
cdystonia <- read_dta("Data/cdystonia.dta") # mapping to Data folder in GitHub repo

# Inspect data
head(cdystonia)

cdystonia <- cdystonia %>% dplyr::mutate(
    trt = dplyr::case_when(
      treat == 1 ~ "10000U",
      treat == 2 ~ "5000U",
      treat == 3 ~ "Placebo"
    ),
    trt = factor(trt, levels = c("Placebo", "5000U", "10000U")),
    sexc = dplyr::case_when(
      sex == 1 ~ "Female",
      sex == 2 ~ "Male"))

# Filter to only week 0
cdystonia_wk0 <- cdystonia %>%
  filter(week == 0)

tbl <- cdystonia_wk0 |>
  tbl_summary(by = trt, 
              include = c(sexc, age,twstrs),
              type=all_continuous()~"continuous2",
              label = list(sexc = "Sex",age~"Age (years)",twstrs="TWSTRS total score at baseline"),
              statistic = list(
      age ~ c(
      "{N_obs}",
      "{mean} ({sd})",
      "{median}",
      "{min}, {max}"),
      all_categorical() ~ "{n} ({p}%)",
      twstrs~"{mean} ({sd})")) |>
  add_overall() |>
  add_p(pvalue_fun = ~style_sigfig(., digits = 4)) |>
  modify_footnote(
    all_stat_cols() ~ 
      "BotB = botulinum toxin type B;TWSTRS = Toronto Western Spasmodic Torticollis Rating Scale.",
    abbreviation = TRUE
  ) |>
  modify_spanning_header(c(stat_2,stat_3)~"**BotB**")

#show_header_names(tbl)

as_kable_extra(tbl,
               booktabs=TRUE,
               longtable=TRUE,
               linesep="",
               caption = "Patient Characteristics at Baseline")
# making a wide dataset
cdystonia_wide <- cdystonia %>%
  pivot_wider(
    id_cols = c(id, trt, site, age, sexc), 
    names_from = week,                     
    values_from = twstrs,              
    names_prefix = "twstrs_"                 
  ) 

ten_subjects_wide <- cdystonia_wide %>% 
  head(10)

tbl2 <-
  ten_subjects_wide %>%
  dplyr::select(id, trt, age, sexc, twstrs_2, twstrs_4, twstrs_8, twstrs_12, twstrs_16) %>%
  
  # 1. Create the gtsummary listing object
  tbl_listing() %>%
  
  # 2. Modify the column headers using modify_header()
  modify_header(
    id = "**ID**",
    trt = "**Group**",
    age = "**Age**",
    sexc = "**Sex**",
    twstrs_2 = "**Week 2**",
    twstrs_4 = "**Week 4**",
    twstrs_8 = "**Week 8**",
    twstrs_12 = "**Week 12**",
    twstrs_16 = "**Week 16**"
  ) %>%
  
  # 3. Convert to gt and apply final formatting
  as_gt() %>%
  gt::tab_header(title="Table 2. TWSTRS scores for 109 patients with CD at weeks 2,4,8,12,16") %>%
  gt::opt_row_striping()

tbl2


```

## Introduction
The purpose of this project is to examine the effects of botulism toxin type B (BotB) to treat cervical dystonia over time. The data comes from a multicenter randomized clinical trial for cervical dystonia patients with 9 U.S. sites. The treatment groups included in the study were placebo, 5000U BotB, and 10000U BotB. The response variable is Toronto Western Spasmodic Torticollis Rating Scale (TWSTRS). The TWSTRS score was measured at week 0 (baseline), and 2,4,6,8,12, and 16 weeks after treatment start.

## Methods


## References